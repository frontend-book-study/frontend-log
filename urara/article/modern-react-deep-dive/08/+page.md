---
title: '8장 좋은 리액트 코드 작성을 위한 환경 구축하기'
created: 2024-05-07
updated: 2024-05-07
tags:
- '모던리액트DeepDive'
---

# 중요한 부분 정리

## ESLint를 활용한 정적 코드 분석

- ESLint: 대표적인 JavaScript 정적 코드 분석 도구
- 정적 코드 분석: 코드의 실행과는 별개로 코드 그 자체만으로 코드 스멜을 찾아내어 문제의 소지가 있는 코드를 사전에 수정하는 것

### ESLint는 어떻게 코드를 분석할까?

1. 자바스크립트 코드를 문자열로 읽음
2. 자바스크립트 코드를 분석할 수 있는 parser(기본값으로 espree 사용)로 코드를 AST 트리로 구조화
3. 구조화된 AST 트리를 기준으로 각종 규칙과 대조
4. 규칙을 위반한 코드를 report 또는 fix

- [AST explorer](https://astexplorer.net/)에서 다양한 파서로 코드를 분석해볼 수 있음

### eslint-plugin과 eslint-config

- eslint-plugin-: 특정 프레임워크나 도메인과 관련된 eslint 규칙을 묶어서 제공하는 패키지
    - ex. eslint-plugin-import, eslint-plugin-react
- eslint-config-: eslint-plugin을 한데 묶어 한 세트로 제공하는 패키지
    - ex. eslint-config-airbnb, @titicaca/triple-config-kit, eslint-config-next

### 나만의 ESLint 규칙 만들기

- 이미 존재하는 규칙을 커스터마이징하거나 완전히 새로운 규칙을 만들 수 있음
- 나만의 ESLint 규칙을 생성해 관리하면 일일이 코드를 수정하는 것 보다 빠르고 쉬우며, 이후에 반복되는 실수도 방지할 수 있음

> lodash 라이브러리는 CommonJS로 작성되어 있어 트리쉐이킹이 되지 않음


> `new Date()`는 기기에 종속된 현재 시간을 반환함

### 주의할 점

- ESLint와 Prettier의 규칙이 충돌할 수 있음
    - Prettier에서 제공하는 규칙을 어기지 않도록 ESLint에서 해당 규칙 끄기
    - 자바스크립트/타입스크립트는 ESLint에, 그 외의 파일은 모두 Prettier에 포맷팅을 맡기고 자바스크립트에 추가적으로 필요한 Prettier 관련 규칙은 eslint-plugin-prettier를 사용

- `eslint-disable-` 주석을 사용해 특정 규칙을 임시로 제외시킬 수 있음
    - 정말로 필요 없는 규칙이라면 "off"를 사용해 끄는 것이 옳음

- ESLint 버전이 충돌할 수 있음
    - 설치하고자 하는 eslint-config, eslint-plugin, 프로젝트에서 지원하는 ESLint 버전 확인하기
    - EsLint 공식 문서에서는 ESLint를 peerDependencies로 설정해 두라고 권장

> "모든 규칙은 존재하는 이유가 있으며, 그러한 이유로 많은 개발자에게 인정받고 설치되어 npm으로 업로드돼 있다. 이 규칙을 따르지 않았을 때 반드시 크건 작건 문제가 생길 수 있다."

## 리액트 팀이 권장하는 리액트 테스트 라이브러리

- `테스트`: 의도대로 작동하는지 확인하는 일련의 작업
- 프런트엔드는 일반적인 사용자와 동일하거나 유사한 환경에서 실행된다. 사용자가 프로그램에서 수행할 주요 비즈니스 로직이나 모든 경우의 수를 고려해야 하며 사용자는 굳이 프런트엔드 코드를 알 필요는 없다. 사용자에게 완전히 노출된 영역이므로 어떻게 작동할지 최대한 예측해서 확인해야 한다.

### React Testing Library란?

- `DOM Testing Library`를 기반으로 만들어진 테스팅 라이브러리. 리액트 기반 테스트를 수행하기 위해 만들어졌다.
- `jsdom`(Node.js 같은 환경에서 HTML과 DOM을 사용할 수 있도록 해주는 라이브러리)를 기반으로 한다.
- 실제 리액트 컴포넌트를 렌더링하지 않고 렌더링되고 있는지 확인 가능하다.

### 자바스크립트 테스트의 기초

1. 테스트할 **함수나 모듈** 선정
2. 함수나 모듈이 반환하길 **기대하는 값** 적기
3. 함수나 모듈의 **실제 반환 값** 적기
4. 3번의 기대와 2번의 결과가 **일치**하는지 확인
5. 기대하는 결과라면 **성공**, 아니면 **에러**

- Node.js에서는 `assert`라는 모듈을 기본으로 제공.
- `어설션 라이브러리`: 테스트 결과를 확인할 수 있도록 도와주는 라이브러리(should.js, expect.js, chai)
- `테스팅 프레임워크`: 어설션을 기반으로 테스트를 수행, 테스트 코드 작성자에게 도움이 될 만한 정보를 알려주는 역할 수행.(Jest, Mocha, Karma, Jasmine)

### 리액트 컴포넌트 테스트 코드 작성하기

1. 컴포넌트 렌더링
2. 컴포넌트에서 특정 액션 수행
3. 기대하는 결과와 실제 결과 비교

#### 동적 컴포넌트(사용자가 useState를 통해 입력을 변경하는 컴포넌트)

- `setup` 함수: 컴포넌트 렌더링, 테스트에 필요한 button, input을 반환하게 묶은 함수
- `userEvent.type`: 사용자가 타이핑하는 것을 흉내 내는 메서드. fireEvent의 여러 이벤트를 순차적으로 실행해 좀 더 자세하게 사용자의 작동을 흉내 낸다.
- `jest.spyOn`: 특정 메서드를 오염시키지 않고 실행이 됐는지, 또 어떤 인수로 실행됐는지 등 실행에 관련된 정보만 얻고 싶을 때 사용한다. (toBeCalledTimes, toBeCalledWith)
- `mockImplementation`: 해당 메서드에 대한 모킹 구현을 도와준다.
    - window.alert 테스트 시 모킹 예시: `jest.spyOn(window, 'alert').mockImplementation((_: string) => undefined)`

#### 비동기 이벤트가 발생하는 컴포넌트

- `MSW(Mock Service Worker)`: Node.js나 브라우저에서 모두 사용할 수 있는 라이브러리.
    - 브라우저에서는 서비스 워커를 활용해 실제 네트워크 요청을 가로채는 방식으로 모킹을 구현한다.
    - Node.js에서는 https나 XMLHttpRequest의 요청을 가로채는 방식으로 작동한다.

```
beforeAll(() => server.listen()) // 테스트코드 시작 전 서버 기동
afterEach(() => server.resetHandlers()) // 테스트 실행마다 초기값 유지
afterAll(() => server.close()) // 테스트코드 종료 후 서버 종료
```

#### 사용자 정의 훅 테스트하기

- `renderHook` 함수: 내부에서 TestComponent 컴포넌트 생성, 이 컴포넌트 내부에서 훅 실행. 따라서 훅의 규칙을 위반하지 않음.

#### 정리

- 테스트 코드 작성 전에 생각해 봐야 할 최우선 과제는 **애플리케이션에서 가장 취약하거나 중요한 부분을 파악하는 것**이다.
- 가장 핵심이 되는 부분부터 먼저 테스트 코드를 하나씩 작성해 나가는 것이 중요하다.
- 테스트가 이뤄야 할 목표는 **애플리케이션이 비즈니스 요구사항을 충족하는지 확인하는 것** 한가지뿐이다.

# 회고

## Liked(좋았던 점)

- 한번 설정해두고 평소에 생각할 일이 없던 도구들에 대해 생각해볼 수 있었음
- 안다고 생각했지만 잘 몰랐던 세부 정적 분석 도구/테스트 요소에 대해 알 수 있었습니다.
- 예시가 함께 작성되어 있어 직접 실행해보지 않아도 볼 수 있어 좋았음

## Learned(배웠던 점)

- 생각 없이 사용만했던 eslint의 내부구조를 파악하기 좋았습니다
- lodash는 트리쉐이킹이 되지 않는다!는 것을 새롭게 알게 되었습니다.
- 프로젝트 상황에 맞게 유연하게 ESLint 규칙을 만들어나갈 수 있다는 관점을 배웠습니다.
- 오픈소스 코드에서 자주 보였던 assert가 테스트코드 결과값 확인 함수라는 것을 알게 되었습니다.

## Lacked(아쉬운 점)

- 삼색볼펜이 의미가 있는지..? 파란색으로만 여러 군데 밑줄치고 있는 걸 발견..
- github action이나 docker 같은 내용은 실습위주인데 어떻게 정리하면 좋을지?

## Longed for(개선점)

- 실습 할 수 있도록 구성해 보기 + 전날까지 공지
